scene = 0

function draw_sprite(xpos, ypos, w, h, spr_start, bg)
	for x=0,w do
		for y=0,h do
			spr(
				y*16+x+spr_start,
				xpos + 8 * x,
				ypos + 8 * y,
				bg
			)
		end
	end
end

function draw_mountains(d, col)
	for x=0,240 do
		for y=50,99 do
			rx = x / 240 - .5
			ry = y / 180 - .5
			if math.sin((rx+d*10)*10+t*30/d)*.01*d < ry + rx*.1 then
				pix(x,y,col)
			end
		end
	end
end

function draw_credits(t)
 txt = ""
	
	if t > 14 and t < 17 then
		draw_sprite(
			90+(t*5)%2, 20+(t*3)%2,
			8, 2, 48
		)
		return
	end
	y = 0
	
	if t > 10 and t < 13 then
		txt = "Music by Credit 3"
		x = 10
		y = 120
	elseif t > 6 and t < 9 then
		txt = "Credit 2"
		x = 180
		y = 40
	elseif t > 2 and t < 5 then
		txt = "Credit 1"
		x = 20
		y = 40
	end
	
	print(txt, x+(t*5)%2, y+(t*3)%2, 12)
end

function swp_col(id, r, g, b)
	poke(0x03fc0 + id*3, r)
	poke(0x03fc1 + id*3, g)
	poke(0x03fc2 + id*3, b)
end

function running_ninja(t)
	cls(2)
	phase = math.floor((t*6)%4)
	swp_col(13, 30, 40, 30)
	swp_col(15, 60, 70, 60)
	draw_mountains(15, 13)
	draw_mountains(10, 15)
	--draw ninja
	x = t*10
	if t > 17 then
		x = t*10+(t-17)*20
	end
	draw_sprite(x, 77,2,2,phase*3,1)
	
	draw_credits(t)
end

function hash(seed)
	return math.sin(78.324 * seed)%1
end

function koi_pond(t)
	cls(8)
	
	for i=0, 16 do
		xran = hash(i * 42.123)*40
		yran = hash(i * 352.452)*40
		x = i%4 * 70 + xran
		y = math.floor(i/4)*100 + yran - t*8
		--draw koi
		draw_sprite(x, y, 2, 3, 96 + 3*(((t+i*.2)*3)%4//1), 0)
	end
	
	for i=0, 10 do
			x = hash(i * 82.123)*200+10
			y = hash(i * 75.452)*200+10-100
			--draw water lily
			draw_sprite(x, y+t*2, 3, 2, 160, 0)
	end
end

function TIC()
	t = time()/1000
	koi_pond(t)
	--running_ninja(t)
end

colSky = {155, 180, 180}
colDawn = {250, 128, 83}
colGrass = {188, 165, 63}
colGround = {68, 60, 54}

function SCN(row)
	if scene == 1 then
		gradient = {0,0,0}
		--sky
		if row < 100 then
			col0 = colSky
			col1 = colDawn
			prc = math.max(0, (row - 50) / 50)
		else
			col0 = colGrass
			col1 = colGround
			prc = math.min((row - 100) / 16, 1)
		end
		for i=1,3 do
			gradient[i] = col0[i]+
				prc*(col1[i]-col0[i])
		end
		--r
		poke(0x03fc0+6, gradient[1])
		--g
		poke(0x03fc1+6, gradient[2])
		--b
		poke(0x03fc2+6, gradient[3])
	end
end

-- <TILES>
-- 000:1111111111111111111111111111111111111111111111111111111111111111
-- 001:1111111111111999111199991111999911119000111199991191999999991999
-- 002:1111111111111111911111119111111101111111911111119111111111811111
-- 003:1111111111111111111111111111111111111111111111111111111111111111
-- 004:1111199911119999111199991111900011119999119199991999199999999111
-- 005:1111111191111111911111110111111191111111911111111111111111111111
-- 006:1111111111111111111111111111111111111111111111111111111111111111
-- 007:1111111111111999111199991111999911119900111199991111999988991999
-- 008:1111111111111111911111119111111101111111911111119111111111111111
-- 009:1111111111111111111111111111111111111111111111111111111111111111
-- 010:1111199911119999111199991111900011119999119199991999199999999111
-- 011:1111111191111111911111110111111191111111911111111111111111111111
-- 016:1111119911111499111144911111111111111111111111111111111111111eee
-- 017:999991119999999819999998119999111ed991111eddddd11eddddddeeeddddd
-- 018:1881111188111111811111111111111111111111111111111111111111111111
-- 019:1111111111111111111111111111111111111111111111111111111111111111
-- 020:99999998999999989999999899d9998199ddd88199ddd88144ddd8114eedd811
-- 021:1111111111111111111111111111111111111111111111111111111111111111
-- 022:1111118811111888111111111111111111111111111111111111111111111ddd
-- 023:889991118999999919999999119999991dd999111ddddde11ddddde1dddddde1
-- 024:1111111199411111994411111111111111111111111111111111111111111111
-- 025:1111111111111111111111111111111111111111111111111111111111111111
-- 026:99999998999999989999999899d9998199ddd88199ddd88144ddd8114eedd811
-- 027:1111111111111111111111111111111111111111111111111111111111111111
-- 032:111eeeee111111ee111111111111111111111111111111111111111111111111
-- 033:eee11dddee111ddd111111dd111111d1111111d1111111111111111111111111
-- 034:1111111111111111111111111111111111111111111111111111111111111111
-- 035:1111111111111111111111111111111111111111111111111111111111111111
-- 036:1eeddd111eeddd111eeddd111ee1dd111e11dd111e11d1111e11d11111111111
-- 037:1111111111111111111111111111111111111111111111111111111111111111
-- 038:1111dddd1111111d111111111111111111111111111111111111111111111111
-- 039:dddddee1ddd1eee11111eee111111e1111111e11111111111111111111111111
-- 040:1111111111111111111111111111111111111111111111111111111111111111
-- 041:1111111111111111111111111111111111111111111111111111111111111111
-- 042:1eeddd111eeddd111eeddd111ee1dd111e11dd111e11d1111e11d11111111111
-- 043:1111111111111111111111111111111111111111111111111111111111111111
-- 048:111111111ccccccc1c1111111c1111111c1111111c1111111c1111cc1c1111c1
-- 049:11111111ccccccc1111111c1111111c1111111c1111111c1cc1111c11c1111c1
-- 050:111111111cccccc11c1111c11c1111c11c1111c11c1111c11c1111c11c1111c1
-- 051:1111111111111111111111111111111111111111111111111111111111111111
-- 052:111111111ccccccc1c1111111c1111111c1111111c1111111c1111cc1c1111c1
-- 053:11111111ccccccc1111111c1111111c1111111c1111111c1cc1111c11c1111c1
-- 054:111111111cccccc11c1111c11c1111c11c1111c11c1111c11c1111c11c1111c1
-- 055:111111111cccccc11c1111c11c1111c11c1111c11c1111c11c1111c11c1111c1
-- 056:1111111111111111111111111111111111111111111111111111111111111111
-- 057:1111111111111111111111111111111111111111111111111111111111111111
-- 058:1111111111111111111111111111111111111111111111111111111111111111
-- 059:1111111111111111111111111111111111111111111111111111111111111111
-- 064:1c1111c11c1111cc1c1111111c1111111c1111111c1111111c1111cc1c1111c1
-- 065:1c1111c1cc1111c1111111c1111111c1111111c1111111c1ccccccc111111111
-- 066:1c1111c11c1111c11c1111c11c1111c11c1111c11c1111c11c1111c11c1111c1
-- 067:1111111111111111111111111111111111111111111111111111111111111111
-- 068:1c1111c11c1111cc1c1111111c1111111c1111111c1111111c1111cc1c1111c1
-- 069:1c1111c1cc1111c1111111c1111111c1111111c1111111c1cc1111c11c1111c1
-- 070:1c1111c11c1111cc1c1111111c1111111c1111111c1111111cccc1111111c111
-- 071:1c1111c1cc1111c1111111c1111111c1111111c1111111c1111cccc1111c1111
-- 072:1111111111111111111111111111111111111111111111111111111111111111
-- 073:1111111111111111111111111111111111111111111111111111111111111111
-- 074:1111111111111111111111111111111111111111111111111111111111111111
-- 075:1111111111111111111111111111111111111111111111111111111111111111
-- 080:1c1111c11c1111c11c1111c11c1111c11c1111c11c1111c11cccccc111111111
-- 081:1111111111111111111111111111111111111111111111111111111111111111
-- 082:1c1111c11c1111cc1c1111111c1111111c1111111c1111111ccccccc11111111
-- 083:11111111ccccccc1111111c1111111c1111111c1111111c1ccccccc111111111
-- 084:1c1111c11c1111c11c1111c11c1111c11c1111c11c1111c11cccccc111111111
-- 085:1c1111c11c1111c11c1111c11c1111c11c1111c11c1111c11cccccc111111111
-- 086:1111c1111111c1111111c1111111c1111111c1111111c1111111cccc11111111
-- 087:111c1111111c1111111c1111111c1111111c1111111c1111cccc111111111111
-- 088:1111111111111111111111111111111111111111111111111111111111111111
-- 089:1111111111111111111111111111111111111111111111111111111111111111
-- 090:1111111111111111111111111111111111111111111111111111111111111111
-- 091:1111111111111111111111111111111111111111111111111111111111111111
-- 097:0000000000000000000000000000ccc000cccc0c00cccccc00ccccc30ccccc33
-- 098:0000000000000000000000000000000000000000c0000000c000000030000000
-- 100:000000000000000000cccc000cccccc0c0cccc0cccccccc3cccccc33cccccc33
-- 103:0000000000000000000000000ccc0000c0cccc00cccccc00ccccc300cccccc30
-- 106:000000000000000000cccc000cccccc0c0cccc0cccccccc3cccccc33cccccc33
-- 112:0000000000000033000003330000033300000003000000000000000000000000
-- 113:3cccccc333cccccc33cccccc33ccc33c3ccc3333cccc33330cccc3300cccccc0
-- 114:00000000c0000000c0000000cc000000ccc00000ccc000000000000000000000
-- 115:0000000000000003000000330000033300000333000000000000000000000000
-- 116:3cccccc333cccccc33cccccc33ccc33c3ccc3333cccc33330cccc3300cccccc0
-- 117:00000000c0000000cc000000ccc00000ccc00000000000000000000000000000
-- 118:0000000000000003000000030000003300000333000003330000000000000000
-- 119:3ccccccc3ccccccc3ccccccc33cccc3c33ccc33333cccc330cccccc003ccccc0
-- 120:00000000cc000000ccc00000ccc00000c0000000000000000000000000000000
-- 121:0000000000000003000000330000033300000333000000000000000000000000
-- 122:3cccccc333cccccc33cccccc33ccc33c3ccc3333cccc33330cccc3300cccccc0
-- 123:00000000c0000000cc000000ccc00000ccc00000000000000000000000000000
-- 129:03ccccc0033ccc30003ccc30000cccc00000ccc0000033c3000003c3000000cc
-- 130:00000000000000000000000000000000000000000000000000000000c0000000
-- 132:03ccccc0033ccc30033cccc0003ccc00003cc300003cc300003cc000000cc000
-- 135:03cccc3003cccc300ccccc000cccc0000ccc00003c3300003c300000cc000000
-- 138:03ccccc0033ccc30033cccc0003ccc00003cc300003cc300003cc000000cc000
-- 145:0000000c00000000000000000000000000000000000000000000000000000000
-- 146:c3000000c33000000cc0000000cc000000cc000000cc00000cc000000c000000
-- 148:000cc000000cc000000ccc000000cc000000cc000000cc00000ccc00000cc000
-- 150:0000003c0000033c00000cc00000cc000000cc000000cc0000000cc0000000c0
-- 151:c000000000000000000000000000000000000000000000000000000000000000
-- 154:000cc000000cc000000ccc000000cc000000cc000000cc00000ccc00000cc000
-- 160:0000000000000000000000000000077700007777000777770077777700777777
-- 161:0000000000000000000000007700000077700000777700007770000000000000
-- 162:0000000000000000000000000077770007777770077777700077770000000000
-- 176:0077777700777777000777770000777700000777000000000000000000000000
-- 177:7000000077700000777700007770000077000000000000000000000000000000
-- 178:00000000007777000777dcd07770c3c70007dcd7007777700077770000000000
-- </TILES>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000
-- </SFX>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

